# 启动选项和配置文件
标签： MySQL 是怎样运行的
*****
如果你用过手机，你的手机上一定有一个设置的功能，你可以选择设置手机的来电铃声、设置音量大小、设置解锁密码等等。假如没有这些设置功能，我们的生活将置于尴尬的境地，比如在图书馆里无法把手机设置为静音，无法把流量开关关掉以节省流量，在别人得知解锁密码后无法更改密码～ MySQL的服务器程序和客户端程序也有很多设置项，比如对于MySQL服务器程序，我们可以指定诸如允许同时连入的客户端数量、客户端和服务器通信方式、表的默认存储引擎、查询缓存的大小吧啦吧啦的设置项。对于MySQL客户端程序，我们之前已经见识过了，可以指定需要连接的服务器程序所在主机的主机名或IP地址、用户名及密码等信息。

这些设置项一般都有各自的默认值，比方说服务器允许同时连入的客户端的默认数量是151，表的默认存储引擎是InnoDB，我们可以在程序启动的时候去修改这些默认值，对于这种在程序启动时指定的设置项也称之为启动选项（startup options），这些选项控制着程序启动后的行为。在MySQL安装目录下的bin目录中的各种可执行文件，不论是服务器相关的程序（比如mysqld、mysqld_safe）还是客户端相关的程序（比如mysql、mysqladmin），在启动的时候基本都可以指定启动参数。这些启动参数可以放在命令行中指定，也可以把它们放在配置文件中指定。下边我们会以mysqld为例，来详细唠叨指定启动选项的格式。需要注意的一点是，我们现在要唠叨的是设置启动选项的方式，下边出现的启动选项不论大家认不认识，先不用去纠结每个选项具体的作用是啥，之后我们会对一些重要的启动选项详细唠叨。
### 在命令行上使用选项
如果我们在启动客户端程序时在-h参数后边紧跟服务器的IP地址，这就意味着客户端和服务器之间需要通过TCP/IP网络进行通信。因为我的客户端程序和服务器程序都装在一台计算机上，所以在使用客户端程序连接服务器程序时指定的主机名是127.0.0.1的情况下，客户端进程和服务器进程之间会使用TCP/IP网络进行通信。如果我们在启动服务器程序的时候就禁止各客户端使用TCP/IP网络进行通信，可以在启动服务器程序的命令行里添加skip-networking启动选项，就像这样：
```shell
mysqld --skip-networking
```
可以看到，我们在命令行中指定启动选项时需要在选项名前加上--前缀。另外，如果选项名是由多个单词构成的，它们之间可以由短划线-连接起来，也可以使用下划线_连接起来，也就是说`skip-networking`和`skip_networking`表示的含义是相同的。所以上边的写法与下边的写法是等价的：
```shell
mysqld --skip_networking
```
在按照上述命令启动服务器程序后，如果我们再使用mysql来启动客户端程序时，再把服务器主机名指定为`127.0.0.1`（IP地址的形式）的话会显示连接失败：
```shell
 mysql -h127.0.0.1 -uroot -p
Enter password:

ERROR 2003 (HY000): Can't connect to MySQL server on '127.0.0.1' (61)
```
这就意味着我们指定的启动选项skip-networking生效了！

再举一个例子，我们前边说过如果在创建表的语句中没有显式指定表的存储引擎的话，那就会默认使用InnoDB作为表的存储引擎。如果我们想改变表的默认存储引擎的话，可以这样写启动服务器的命令行：
```shell
mysqld --default-storage-engine=MyISAM
```
我们现在就已经把表的默认存储引擎改为MyISAM了，在客户端程序连接到服务器程序后试着创建一个表：
```shell
mysql> CREATE TABLE sys_var_demo(
    ->     i INT
    -> );
Query OK, 0 rows affected (0.02 sec)
```
这个定义语句中我们并没有明确指定表的存储引擎，创建成功后再看一下这个表的结构：
```shell
mysql> SHOW CREATE TABLE sys_var_demo\G
*************************** 1. row ***************************
       Table: sys_var_demo
Create Table: CREATE TABLE `sys_var_demo` (
  `i` int(11) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8
1 row in set (0.01 sec)
```
可以看到该表的存储引擎已经是MyISAM了，说明启动选项`default-storage-engine`生效了。

所以在启动服务器程序的命令行后边指定启动选项的通用格式就是这样的：
```text
--启动选项1[=值1] --启动选项2[=值2] ... --启动选项n[=值n]
```
也就是说我们可以将各个启动选项写到一行中，各个启动选项之间使用空白字符隔开，在每一个启动选项名称前边添加--。对于不需要值的启动选项，比方说skip-networking，它们就不需要指定对应的值。对于需要指定值的启动选项，比如default-storage-engine我们在指定这个设置项的时候需要显式的指定它的值，比方说InnoDB、MyISAM啦什么的～ 在命令行上指定有值的启动选项时需要注意，选项名、=、选项值之间不可以有空白字符，比如写成下边这样就是不正确的：
```shell
mysqld --default-storage-engine = MyISAM
```
**每个MySQL程序都有许多不同的选项。大多数程序提供了一个--help选项，你可以查看该程序支持的全部启动选项以及它们的默认值**。例如，使用`mysql --help`可以看到mysql程序支持的启动选项，`mysqld_safe --help`可以看到mysqld_safe程序支持的启动选项。查看mysqld支持的启动选项有些特别，需要使用`mysqld --verbose --help`。
#### 选项的长形式和短形式
我们前边提到的`skip-networking`、`default-storage-engine`称之为长形式的选项（因为它们很长），设计MySQL的大叔为了我们使用的方便，对于一些常用的选项提供了短形式，我们列举一些具有短形式的启动选项来瞅瞅（MySQL支持的短形式选项太多了，全列出来会刷屏的）：

|长形式|短形式|含义|
|:---:|:---:|:---|
|--host|-h|主机名|
|--user|-u|用户名|
|--password|-p|密码|
|--port|-P|端口|
|--version|-V|版本信息|

短形式的选项名只有一个字母，与使用长形式选项时需要在选项名前加两个短划线--不同的是，使用短形式选项时在选项名前只加一个短划线-前缀。有一些短形式的选项我们之前已经接触过了，比方说我们在启动服务器程序时指定监听的端口号：
```shell
mysqld -P3307
```
使用短形式指定启动选项时，选项名和选项值之间可以没有间隙，或者用空白字符隔开（-p选项有些特殊，-p和密码值之间不能有空白字符），也就是说上边的命令形式和下边的是等价的：
```shell
mysqld -P 3307
```
另外，选项名是区分大小写的，比如-p和-P选项拥有完全不同的含义，大家需要注意一下。
### 配置文件中使用选项
在命令行中设置启动选项只对当次启动生效，也就是说如果下一次重启程序的时候我们还想保留这些启动选项的话，还得重复把这些选项写到启动命令行中，这样真的神烦唉！于是设计MySQL的大叔们提出一种配置文件（也称为选项文件）的概念，我们把需要设置的启动选项都写在这个配置文件中，每次启动服务器的时候都从这个文件里加载相应的启动选项。由于这个配置文件可以长久的保存在计算机的硬盘里，所以只需我们配置一次，以后就都不用显式的把启动选项都写在启动命令行中了，**所以我们推荐使用配置文件的方式来设置启动选项**。
#### 配置文件的路径
MySQL程序在启动时会寻找多个路径下的配置文件，这些路径有的是固定的，有的是可以在命令行指定的。根据操作系统的不同，配置文件的路径也有所不同，我们分开看一下。
##### Windows操作系统的配置文件
在Windows操作系统中，MySQL会按照下列路径来寻找配置文件：